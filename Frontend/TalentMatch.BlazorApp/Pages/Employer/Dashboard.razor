@page "/employer/dashboard"
@using TalentMatch.BlazorApp.Models.DTOs.JobPosting.Request
@using TalentMatch.BlazorApp.Models.DTOs.JobPosting.Response
@using TalentMatch.BlazorApp.Models.Interfaces.Services
@attribute [Authorize(Roles = "Employer")]
@inject IJobPostingService JobService

<PageTitle>Dashboard - Mis Vacantes</PageTitle>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h3>Mis Vacantes Publicadas</h3>
    <a href="/employer/postjob" class="btn btn-primary">
        <i class="oi oi-plus"></i> Nueva Vacante
    </a>
</div>

@if (isLoading)
{
    <div class="text-center my-5">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Cargando...</span>
        </div>
    </div>
}
else if (jobs == null || !jobs.Any())
{
    <div class="alert alert-info">
        No has publicado vacantes aún. <a href="/employer/postjob">Publica tu primera vacante</a>
    </div>
}
else
{
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Título</th>
                    <th>Ubicación</th>
                    <th>Modalidad</th>
                    <th>Salario</th>
                    <th>Estado</th>
                    <th>Fecha</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var job in jobs)
                {
                    <tr>
                        <td>@job.Title</td>
                        <td>@job.Location</td>
                        <td>@job.WorkMode</td>
                        <td>$@job.SalaryMin.ToString("N0") - $@job.SalaryMax.ToString("N0")</td>
                        <td>
                            @if (job.IsActive)
                            {
                                <span class="badge bg-success">Activa</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">Inactiva</span>
                            }
                        </td>
                        <td>@job.PostedDate.ToString("dd/MM/yyyy")</td>
                        <td>
                            <a href="/employer/applicants/@job.JobId" class="btn btn-sm btn-primary">
                                Ver Candidatos
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@code {
    private List<GetJobPostingDtoResponse> jobs = new();
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var filter = new JobPostingQueryFilter(); 
            var response = await JobService.GetJobPostings(filter);
            jobs = response.Data.Data;

        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading jobs: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }
}